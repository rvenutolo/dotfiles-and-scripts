#!/usr/bin/env bash

if [[ -z "${SDKMAN_DIR}" ]]; then
  echo 'SDKMAN_DIR is not set' >&2
  exit 2
fi

set -euo pipefail

dir="$PWD"
project_root="$PWD"
while [[ "$dir" != / ]]; do
  if [[ -f "$dir/settings.gradle" || -f "$dir/settings.gradle.kts" || -f "$dir/gradlew" ]]; then
    project_root="$dir"
    break
  fi
  dir="$(dirname "${dir}")"
done

readonly sdkman_gradle="${SDKMAN_DIR}/candidates/gradle/current/bin/gradle"

if [[ -x "$project_root/gradlew" ]]; then
  echo "Executing gradlew instead of gradle"
  "${project_root}/gradlew" "$@"
elif [[ -x "${sdkman_gradle}" ]]; then
  "${sdkman_gradle}" "$@"
else
  echo 'No gradlew or gradle available' >&2
  exit 2
fi
