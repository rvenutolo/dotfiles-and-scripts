#!/usr/bin/env groovy

final String securityFilePath = "${System.getProperty('java.home')}/lib/security/java.security"
final String backupFilePath = "${securityFilePath}.${new Date().format('yyyyMMdd_HHmmss')}.bak"

new File(securityFilePath).renameTo(backupFilePath)
println("Renamed ${securityFilePath} to ${backupFilePath}")

println("Writing ${securityFilePath}")
new File(securityFilePath).withWriter('UTF-8') {writer ->
    new File(backupFilePath).eachLine {line ->
        if (line.startsWith('jdk.certpath.disabledAlgorithms') && line.contains('MD5, ')) {
            writer.write("#${line}\n")
            writer.write("${line - 'MD5, '}\n")
        } else if (line.startsWith('jdk.tls.disabledAlgorithms') && line.contains('MD5withRSA, ')) {
            writer.write("#${line}\n")
            writer.write("${line - 'MD5withRSA, '}\n")
        } else {
            writer.write(line + '\n')
        }
    }
}
println("Wrote ${securityFilePath}")
